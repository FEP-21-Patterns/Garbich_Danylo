<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SmartApp IoT Dashboard</title>
    <!-- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —à–ª—è—Ö –¥–æ style.css –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π -->
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <h1>üè† SmartApp IoT Dashboard</h1>
    </header>

    <main>
        <!-- –¶–µ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä JavaScript –∑–∞–ø–æ–≤–Ω–∏—Ç—å –¥–∞–Ω–∏–º–∏ -->
        <section class="devices" id="devices-container">
            <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤...</p>
        </section>
    </main>

    <footer>
        <p>¬© 2025 SmartApp IoT ‚Äî Microservices Demo</p>
    </footer>

    <!-- [–ù–û–í–ò–ô –°–ö–†–ò–ü–¢] -->
    <script>
        // –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è, –∫–æ–ª–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è
        document.addEventListener("DOMContentLoaded", () => {
            loadDevices();
        });

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
        async function loadDevices() {
            const container = document.getElementById("devices-container");

            try {
                // 1. –†–æ–±–∏–º–æ GET-–∑–∞–ø–∏—Ç –¥–æ –Ω–∞—à–æ–≥–æ –Ω–æ–≤–æ–≥–æ API
                // [–í–ò–ü–†–ê–í–õ–ï–ù–û] –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–æ–≤–Ω–∏–π (–∞–±—Å–æ–ª—é—Ç–Ω–∏–π) URL, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —à–ª—è—Ö –Ω–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î—Ç—å—Å—è
                const response = await fetch('http://localhost:5000/api/devices');

                if (!response.ok) {
                    throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
                }

                const devices = await response.json();

                // 2. –û—á–∏—â—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                if (devices.length === 0) {
                    container.innerHTML = "<p>–ü—Ä–∏—Å—Ç—Ä–æ—ó–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ (5001, 5002, 5003) –∑–∞–ø—É—â–µ–Ω—ñ.</p>";
                    return;
                }

                container.innerHTML = ""; // –û—á–∏—â—É—î–º–æ "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..."

                // 3. –°—Ç–≤–æ—Ä—é—î–º–æ HTML –¥–ª—è –∫–æ–∂–Ω–æ—ó –∫–∞—Ä—Ç–∫–∏ –ø—Ä–∏—Å—Ç—Ä–æ—é
                devices.forEach(device => {
                    const card = document.createElement("div");
                    card.className = "device-card";
                    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó HTML –∫–∞—Ä—Ç–∫–∏
                    card.innerHTML = createDeviceCardHTML(device);
                    container.appendChild(card);
                });

            } catch (error) {
                console.error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä–æ—ó:", error);
                container.innerHTML = "<p>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) —ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞–ø—É—â–µ–Ω—ñ.</p>";
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó HTML –æ–¥–Ω—ñ—î—ó –∫–∞—Ä—Ç–∫–∏
        function createDeviceCardHTML(device) {
            let statusHTML = "";
            let controlsHTML = "";
            let title = device.type.replace('_', ' ');

            // –ì–µ–Ω–µ—Ä—É—î–º–æ HTML –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Ç–∏–ø—É –ø—Ä–∏—Å—Ç—Ä–æ—é
            if (device.type === "smart_speaker") {
                const statusText = device.is_on ? "ON" : "OFF";
                const buttonText = device.is_on ? "Turn Off" : "Turn On";
                statusHTML = `<p>Status: ${statusText}</p>`;
                controlsHTML = `
                    <form action="/toggle_speaker" method="post">
                        <button type="submit" class="btn">${buttonText}</button>
                    </form>
                    <p>Volume: ${device.volume}%</p>
                `;
            } else if (device.type === "smart_light") {
                const statusText = device.is_on ? "ON" : "OFF";
                const buttonText = device.is_on ? "Turn Off" : "Turn On";
                statusHTML = `<p>Status: ${statusText}</p>`;
                controlsHTML = `
                    <form action="/toggle_light" method="post">
                        <button type="submit" class="btn">${buttonText}</button>
                    </form>
                    <p>Brightness: ${device.brightness}%</p>
                `;
            } else if (device.type === "smart_curtains") {
                const statusText = device.is_open ? "OPEN" : "CLOSED";
                const buttonText = device.is_open ? "Close" : "Open";
                statusHTML = `<p>Status: ${statusText}</p>`;
                controlsHTML = `
                    <form action="/toggle_curtains" method="post">
                        <button type="submit" class="btn">${buttonText}</button>
                    </form>
                    <p>Position: ${device.position}%</p>
                `;
            }

            // –ó–±–∏—Ä–∞—î–º–æ –≤—Å–µ –¥–æ –∫—É–ø–∏
            return `
                <h2>${title.charAt(0).toUpperCase() + title.slice(1)}</h2>
                <p><strong>ID:</strong> ${device.device_id}</p>
                <p><strong>Connection:</strong> ${device.connection}</p>
                ${statusHTML}
                ${controlsHTML}
            `;
        }
    </script>
</body>
</html>